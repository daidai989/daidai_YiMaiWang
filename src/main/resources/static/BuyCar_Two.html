<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link type="text/css" rel="stylesheet" href="css/style.css" />
    <!--[if IE 6]>
    <script src="js/iepng.js" type="text/javascript"></script>
    <script type="text/javascript">
        EvPNG.fix('div, ul, img, li, input, a');
    </script>
    <![endif]-->
    <script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" src="js/menu.js"></script>

    <script type="text/javascript" src="js/n_nav.js"></script>

    <script type="text/javascript" src="js/select.js"></script>

    <script type="text/javascript" src="js/num.js">
        var jq = jQuery.noConflict();
    </script>

    <script type="text/javascript" src="js/shade.js"></script>
    <script src="js/vue.js"></script>
    <script src="js/axios.js"></script>
    <script src="js/element.js"></script>

    <title>尤洪</title>
</head>

<body>
<div id="app4">
    <!--Begin Header Begin-->
    <div class="soubg">
        <div class="sou">
            <!--Begin 所在收货地区 Begin-->
            <span class="s_city_b">
                    <span class="fl">送货至：</span>
                    <span class="s_city">
                        <span>四川</span>
                        <div class="s_city_bg">
                            <div class="s_city_t"></div>
                            <div class="s_city_c">
                                <h2>请选择所在的收货地区</h2>
                                <table border="0" class="c_tab" style="width:235px; margin-top:10px;" cellspacing="0"
                                       cellpadding="0">
                                    <tr>
                                        <th>A</th>
                                        <td class="c_h"><span>安徽</span><span>澳门</span></td>
                                    </tr>
                                    <tr>
                                        <th>B</th>
                                        <td class="c_h"><span>北京</span></td>
                                    </tr>
                                    <tr>
                                        <th>C</th>
                                        <td class="c_h"><span>重庆</span></td>
                                    </tr>
                                    <tr>
                                        <th>F</th>
                                        <td class="c_h"><span>福建</span></td>
                                    </tr>
                                    <tr>
                                        <th>G</th>
                                        <td class="c_h"><span>广东</span><span>广西</span><span>贵州</span><span>甘肃</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>H</th>
                                        <td class="c_h">
                                            <span>河北</span><span>河南</span><span>黑龙江</span><span>海南</span><span>湖北</span><span>湖南</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>J</th>
                                        <td class="c_h"><span>江苏</span><span>吉林</span><span>江西</span></td>
                                    </tr>
                                    <tr>
                                        <th>L</th>
                                        <td class="c_h"><span>辽宁</span></td>
                                    </tr>
                                    <tr>
                                        <th>N</th>
                                        <td class="c_h"><span>内蒙古</span><span>宁夏</span></td>
                                    </tr>
                                    <tr>
                                        <th>Q</th>
                                        <td class="c_h"><span>青海</span></td>
                                    </tr>
                                    <tr>
                                        <th>S</th>
                                        <td class="c_h"><span>上海</span><span>山东</span><span>山西</span><span
                                                class="c_check">四川</span><span>陕西</span></td>
                                    </tr>
                                    <tr>
                                        <th>T</th>
                                        <td class="c_h"><span>台湾</span><span>天津</span></td>
                                    </tr>
                                    <tr>
                                        <th>X</th>
                                        <td class="c_h"><span>西藏</span><span>香港</span><span>新疆</span></td>
                                    </tr>
                                    <tr>
                                        <th>Y</th>
                                        <td class="c_h"><span>云南</span></td>
                                    </tr>
                                    <tr>
                                        <th>Z</th>
                                        <td class="c_h"><span>浙江</span></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </span>
                </span>
            <!--End 所在收货地区 End-->
            <span class="fr">
                     <span class="fl">你好，{{$data.user.username ?  $data.user.username : '请登录'}}&nbsp;<a v-if="!$data.user.username" href="Login.html">登录</a>&nbsp;&nbsp;<a v-if="$data.user.username" href="javascript:void(0)" @click="logout()">注销</a>&nbsp;&nbsp; <a href="Regist.html" style="color:#ff4e00;">免费注册</a>&nbsp;|&nbsp;<a
                             href="#">我的订单</a>&nbsp;|</span>
                    <span class="ss">
                        <div class="ss_list">
                            <a href="#">收藏夹</a>
                            <div class="ss_list_bg">
                                <div class="s_city_t"></div>
                                <div class="ss_list_c">
                                    <ul>
                                        <li><a href="#">我的收藏夹</a></li>
                                        <li><a href="#">我的收藏夹</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="ss_list">
                            <a href="#">客户服务</a>
                            <div class="ss_list_bg">
                                <div class="s_city_t"></div>
                                <div class="ss_list_c">
                                    <ul>
                                        <li><a href="#">客户服务</a></li>
                                        <li><a href="#">客户服务</a></li>
                                        <li><a href="#">客户服务</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="ss_list">
                            <a href="#">网站导航</a>
                            <div class="ss_list_bg">
                                <div class="s_city_t"></div>
                                <div class="ss_list_c">
                                    <ul>
                                        <li><a href="#">网站导航</a></li>
                                        <li><a href="#">网站导航</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </span>
                    <span class="fl">|&nbsp;关注我们：</span>
                    <span class="s_sh"><a href="#" class="sh1">新浪</a><a href="#" class="sh2">微信</a></span>
                    <span class="fr">|&nbsp;<a href="#">手机版&nbsp;<img src="images/s_tel.png"
                                                                         align="absmiddle" /></a></span>
                </span>
        </div>
    </div>
    <div class="top">
        <div class="logo"><a href="Index.html"><img src="images/logo.png" /></a></div>
        <div class="search">
            <form>
                <input type="text" value="" class="s_ipt" />
                <input type="submit" value="搜索" class="s_btn" />
            </form>
            <span class="fl"><a href="#">咖啡</a><a href="#">iphone 6S</a><a href="#">新鲜美食</a><a href="#">蛋糕</a><a
                    href="#">日用品</a><a href="#">连衣裙</a></span>
        </div>

    </div>
    <!--End Header End-->
    <!--Begin Menu Begin-->
    <div class="menu_bg">
        <div class="menu">
            <!--Begin 商品分类详情 Begin-->
            <div class="nav">
                <div class="nav_t">全部商品分类</div>
                <div class="leftNav none">
                    <ul>
                        <li v-for="(item, index) in theFirst" :key="index"
                            @mouseenter="loadSecondAndThird(item.id)">
                            <div class="fj">
                                <span class="n_img"><span></span><img src="images/nav1.png" /></span>
                                <span class="fl">{{item.name}}</span>
                            </div>
                            <div class="zj">
                                <div class="zj_l">
                                    <div class="zj_l_c" v-for="(subItem, index) in theSecond" :key="index">
                                        <h2>{{subItem.name}}</h2>
                                        <a v-for="(subItem, index) in theThird" :key="index">{{subItem.name}}|</a>
                                    </div>
                                </div>
                            </div>
                        </li>

                    </ul>
                </div>
            </div>
            <!--End 商品分类详情 End-->
            <ul class="menu_r">
                <li><a href="Index.html">首页</a></li>
                <li><a href="Food.html">美食</a></li>
                <li><a href="Fresh.html">生鲜</a></li>
                <li><a href="HomeDecoration.html">家居</a></li>
                <li><a href="SuitDress.html">女装</a></li>
                <li><a href="MakeUp.html">美妆</a></li>
                <li><a href="Digital.html">数码</a></li>
                <li><a href="GroupBuying.html">团购</a></li>
            </ul>
            <div class="m_ad">中秋送好礼！</div>
        </div>
    </div>
    <!--End Menu End-->
    <div class="i_bg">
        <div class="content mar_20">
            <img src="images/img2.jpg" />
        </div>

        <!--Begin 第二步：确认订单信息 Begin -->
        <div class="content mar_20" v-if="products.length>0">
            <div class="two_bg">
                <div class="two_t">
                    <span class="fr"><a href="javascript:history.back();">修改</a></span>
                </div>
                <table border="0" class="car_tab" style="width:1110px;" cellspacing="0" cellpadding="0">
                    <tr>
                        <td class="car_th" width="550">商品名称</td>
                        <td class="car_th" width="140">属性</td>
                        <td class="car_th" width="150">购买数量</td>
                        <td class="car_th" width="130">小计</td>
                        <td class="car_th" width="140">返还积分</td>
                    </tr>
                    <tr v-for="(item,index) in products" :key="index">
                        <td>
                            <div class="c_s_img"><img
                                    :src="'http://localhost:8080/getImage?filePath=' + item.filePath" width="73"
                                    height="73" /></div>
                            {{item.name}}
                        </td>
                        <td align="center">颜色：灰色</td>
                        <td align="center">{{item.count}}</td>
                        <td align="center" style="color:#ff4e00;">￥{{item.price*item.count}}</td>
                        <td align="center">{{(item.price*item.count*0.1).toFixed(1)}}R</td>
                    </tr>

                    <tr>
                        <td colspan="5" align="right" style="font-family:'Microsoft YaHei';">
                            商品总价：￥{{totalPrice}}； 返还积分 ￥{{(totalPrice*0.1).toFixed(1)}}R
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div v-else class="content mar_20">
            暂无购买内容
        </div>
        <div class="two_t">
            <span class="fr"><a href="#">修改</a></span>收货人信息
        </div>
        <table border="0" class="peo_tab" style="width:1110px;" cellspacing="0" cellpadding="0">
            <tr>
                <td class="p_td" width="160">用户名称</td>
                <td width="395">{{address.username}}</td>
                <td class="p_td" width="160">电子邮件</td>
                <td width="395">{{address.email}}</td>
            </tr>
            <tr>
                <td class="p_td">详细信息</td>
                <td>{{address.address}}</td>
                <td class="p_td">电话号码</td>
                <td>{{address.mobile}}</td>
            </tr>
            <tr>
                <td class="p_td">备注</td>
                <td>{{address.remark}}</td>
                <td class="p_td">最佳送货时间</td>
                <td>当天发货</td>
            </tr>
        </table>






        <ul class="pay">
            <a  @click="toSubmit()">
                <li style="width: 200px;
    margin-left: 436px;
    font-size: x-large;
    margin-top: 30px;
    color: darkgreen;">提交订单<div class="ch_img"></div>
                </li>
            </a>
        </ul>




        <!--Begin Footer Begin -->
        <div class="b_btm_bg bg_color">
            <div class="b_btm">
                <table border="0" style="width:210px; height:62px; float:left; margin-left:75px; margin-top:30px;"
                       cellspacing="0" cellpadding="0">
                    <tr>
                        <td width="72"><img src="images/b1.png" width="62" height="62" /></td>
                        <td>
                            <h2>正品保障</h2>正品行货 放心购买
                        </td>
                    </tr>
                </table>
                <table border="0" style="width:210px; height:62px; float:left; margin-left:75px; margin-top:30px;"
                       cellspacing="0" cellpadding="0">
                    <tr>
                        <td width="72"><img src="images/b2.png" width="62" height="62" /></td>
                        <td>
                            <h2>满38包邮</h2>满38包邮 免运费
                        </td>
                    </tr>
                </table>
                <table border="0" style="width:210px; height:62px; float:left; margin-left:75px; margin-top:30px;"
                       cellspacing="0" cellpadding="0">
                    <tr>
                        <td width="72"><img src="images/b3.png" width="62" height="62" /></td>
                        <td>
                            <h2>天天低价</h2>天天低价 畅选无忧
                        </td>
                    </tr>
                </table>
                <table border="0" style="width:210px; height:62px; float:left; margin-left:75px; margin-top:30px;"
                       cellspacing="0" cellpadding="0">
                    <tr>
                        <td width="72"><img src="images/b4.png" width="62" height="62" /></td>
                        <td>
                            <h2>准时送达</h2>收货时间由你做主
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="b_nav">
            <dl>
                <dt><a href="#">新手上路</a></dt>
                <dd><a href="#">售后流程</a></dd>
                <dd><a href="#">购物流程</a></dd>
                <dd><a href="#">订购方式</a></dd>
                <dd><a href="#">隐私声明</a></dd>
                <dd><a href="#">推荐分享说明</a></dd>
            </dl>
            <dl>
                <dt><a href="#">配送与支付</a></dt>
                <dd><a href="#">货到付款区域</a></dd>
                <dd><a href="#">配送支付查询</a></dd>
                <dd><a href="#">支付方式说明</a></dd>
            </dl>
            <dl>
                <dt><a href="#">会员中心</a></dt>
                <dd><a href="#">资金管理</a></dd>
                <dd><a href="#">我的收藏</a></dd>
                <dd><a href="#">我的订单</a></dd>
            </dl>
            <dl>
                <dt><a href="#">服务保证</a></dt>
                <dd><a href="#">退换货原则</a></dd>
                <dd><a href="#">售后服务保证</a></dd>
                <dd><a href="#">产品质量保证</a></dd>
            </dl>
            <dl>
                <dt><a href="#">联系我们</a></dt>
                <dd><a href="#">网站故障报告</a></dd>
                <dd><a href="#">购物咨询</a></dd>
                <dd><a href="#">投诉与建议</a></dd>
            </dl>
            <div class="b_tel_bg">
                <a href="#" class="b_sh1">新浪微博</a>
                <a href="#" class="b_sh2">腾讯微博</a>
                <p>
                    服务热线：<br />
                    <span>400-123-4567</span>
                </p>
            </div>
            <div class="b_er">
                <div class="b_er_c"><img src="images/er.gif" width="118" height="118" /></div>
                <img src="images/ss.png" />
            </div>
        </div>
        <div class="btmbg">
            <div class="btm">
                备案/许可证编号：蜀ICP备12009302号-1-www.dingguagua.com Copyright © 2015-2018 尤洪商城网 All Rights Reserved. 复制必究 ,
                Technical Support: Dgg Group <br />
                <img src="images/b_1.gif" width="98" height="33" /><img src="images/b_2.gif" width="98"
                                                                        height="33" /><img src="images/b_3.gif" width="98" height="33" /><img src="images/b_4.gif"
                                                                                                                                              width="98" height="33" /><img src="images/b_5.gif" width="98" height="33" /><img
                    src="images/b_6.gif" width="98" height="33" />
            </div>
        </div>
    </div>
</div>

</body>
<script type="text/javascript">
    new Vue({
        el: '#app4',
        data: {
            count:0,
            secondProList:"",
            proList:[],
            serialNumber:"",
            totalPrice: null,
            address: {
                username:"",
                email:"",
                address:"",
                mobile:"",
                remark:""
            },
            getUser:[],
            user: {
                username: "",
                id: null,
                productId: null,
            },
            products: [],
            theFirst: [],
            theSecond: [],
            theThird: [],
            pro:{
                id:null,
                loginName: "",
                userAddress:"",
                cost:null,
            }
        },
        methods: {
            firstLoad() {
                axios.get('http://localhost:8080/getFirstCategory')
                    .then((resp) => {
                        this.theFirst = resp.data.data;
                    });
            },
            loadSecondAndThird(id) {
                this.secondLoad(id);
            },
            secondLoad(id) {
                axios.get('http://localhost:8080/getSecondCategory', {
                    params: {
                        id: id
                    }
                })
                    .then((resp) => {
                        this.theSecond = resp.data.data;
                        if (this.theSecond.length > 0) {
                            this.thirdLoad(this.theSecond[0].id);
                        }
                    });
            },
            thirdLoad(id) {
                axios.get('http://localhost:8080/getThirdCategory', {
                    params: {
                        id: id
                    }
                })
                    .then((resp) => {
                        this.theThird = resp.data.data;
                    });
            },
            initLogin() {
                let token = localStorage.getItem("token");
                axios.get('http://localhost:8080/getUser', {
                    params: {
                        token: token
                    }
                })
                    .then((resp) => {
                        console.log(resp.data)
                        this.getUser=resp.data.data
                        this.user.username = resp.data.data.userName
                        this.user.id = resp.data.data.id
                        this.initAddress(this.user.id)

                    });
            },
            initCat() {
                axios.post('http://localhost:8080/getProductListByLst', { ids: this.proList })
                    .then((resp) => {
                        console.log(resp.data);
                        this.products = resp.data.data
                        let sum = 0;
                        this.productLength = this.products.length
                        for (let i = 0; i < this.products.length; i++) {
                            sum += this.products[i].price * this.products[i].count;
                            this.totalPrice = sum;
                        }
                    });
            },

            initAddress(id) {
                console.log(this.user.id)
                axios.get('http://localhost:8080/getDefaultAdd', {
                    params: {
                        id: id
                    }
                })
                    .then((resp) => {
                        this.address.username=resp.data.data.userName;
                        this.address.email=resp.data.data.email;
                        this.address.address=resp.data.data.address;
                        this.address.mobile=resp.data.data.mobile;
                        this.address.remark=resp.data.data.remark;

                    });
            },
            logout() {
                let token=localStorage.getItem("token");
                localStorage.removeItem("token");
                axios.get('http://localhost:8080/logout', {params: {token: token}})
                    .then((resp) => {
                        window.location.href="index.html"
                    });
            },
            async toSubmit() {
                console.log(this.products);
                console.log(this.getUser);

                const data = {
                    products: this.products,
                    user: this.getUser
                };

                try {
                    const resp = await axios.post('http://localhost:8080/OrderSubmit', data);
                    if (resp.data.code !== 200) {
                        this.$message.success(resp.data.message);
                    }
                    this.serialNumber = resp.data.data;
                    window.location.href = "BuyCar_Three.html?serialNumber=" + this.serialNumber + "&totalPrice=" + this.totalPrice;
                } catch (error) {
                    console.error(error);
                }
            },
            initProductList() {
                axios.post('http://localhost:8080/getProductListByproductList', { ids: this.ids })
                    .then((resp) => {
                        console.log(resp.data);
                        console.log(resp.data);
                        this.products = resp.data.data

                        let sum = 0;
                        this.productLength = this.products.length
                        for (let i = 0; i < this.products.length; i++) {
                            if (this.products[i].count===null){
                                this.products[i].count=this.count
                            }
                            if (this.products[i].productId===null){
                                this.products[i].productId=this.products[i].id
                            }
                            sum += this.products[i].price * this.products[i].count;
                            this.totalPrice = sum;
                        }
                    });
            },
            initProductList1(ids,amount) {
                axios.get("/getProductListByIdStr", {
                    params: {
                        idStr: ids,
                        count:amount
                    }
                }).then((resp) => {
                    console.log(resp)
                    this.productList = resp.data.data;
                })
            },




        },
        mounted() {
            const urlParams = new URLSearchParams(window.location.search);
            const selectedIdsStr = urlParams.get('selectedIds');
            if (selectedIdsStr!==null&&selectedIdsStr.length>0){
                selectedIdsStr.split(',').forEach(id => {
                    const num = parseInt(id, 10);
                    this.proList.push(num)
                });
            }
            console.log(this.proList)
            const urlParams1 = new URLSearchParams(window.location.search);
            const idsString = decodeURIComponent(urlParams1.get('ids'));
            const ids = JSON.parse(idsString);
            this.ids=ids
            console.log(ids)
            const recommendNum = parseInt(urlParams1.get('recommendNum'));
            this.count=recommendNum
            this.firstLoad();
            this.initLogin()
            if (this.proList.length>0){
                this.initCat()
            }
            if (this.ids.length>0){
                this.initProductList()

            }


        }
    })
</script>


</html>