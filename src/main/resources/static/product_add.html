<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link type="text/css" rel="stylesheet" href="css/style.css" />
    <link type="text/css" rel="stylesheet" href="css/antd.css">
    <link rel="stylesheet" href="css/element.css">
    <script src="js/iepng.js" type="text/javascript"></script>
    <script type="text/javascript">
        EvPNG.fix('div, ul, img, li, input, a');
    </script>
    <![endif]-->
    <script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" src="js/menu.js"></script>

    <script type="text/javascript" src="js/select.js"></script>
    <script src="js/vue.js"></script>
    <script src="js/axios.js"></script>
    <script src="js/antd.js"></script>
    <script src="js/element.js"></script>
    <title>尤洪</title>

</head>

<body>
<div id="app15">

    <div class="soubg">
        <div class="sou">
            <!--Begin 所在收货地区 Begin-->
            <span class="s_city_b">
        	<span class="fl">送货至：</span>
            <span class="s_city">
            	<span>四川</span>
                <div class="s_city_bg">
                	<div class="s_city_t"></div>
                    <div class="s_city_c">
                    	<h2>请选择所在的收货地区</h2>
                        <table border="0" class="c_tab" style="width:235px; margin-top:10px;" cellspacing="0" cellpadding="0">
                          <tr>
                            <th>A</th>
                            <td class="c_h"><span>安徽</span><span>澳门</span></td>
                          </tr>
                          <tr>
                            <th>B</th>
                            <td class="c_h"><span>北京</span></td>
                          </tr>
                          <tr>
                            <th>C</th>
                            <td class="c_h"><span>重庆</span></td>
                          </tr>
                          <tr>
                            <th>F</th>
                            <td class="c_h"><span>福建</span></td>
                          </tr>
                          <tr>
                            <th>G</th>
                            <td class="c_h"><span>广东</span><span>广西</span><span>贵州</span><span>甘肃</span></td>
                          </tr>
                          <tr>
                            <th>H</th>
                            <td class="c_h"><span>河北</span><span>河南</span><span>黑龙江</span><span>海南</span><span>湖北</span><span>湖南</span></td>
                          </tr>
                          <tr>
                            <th>J</th>
                            <td class="c_h"><span>江苏</span><span>吉林</span><span>江西</span></td>
                          </tr>
                          <tr>
                            <th>L</th>
                            <td class="c_h"><span>辽宁</span></td>
                          </tr>
                          <tr>
                            <th>N</th>
                            <td class="c_h"><span>内蒙古</span><span>宁夏</span></td>
                          </tr>
                          <tr>
                            <th>Q</th>
                            <td class="c_h"><span>青海</span></td>
                          </tr>
                          <tr>
                            <th>S</th>
                            <td class="c_h"><span>上海</span><span>山东</span><span>山西</span><span class="c_check">四川</span><span>陕西</span></td>
                          </tr>
                          <tr>
                            <th>T</th>
                            <td class="c_h"><span>台湾</span><span>天津</span></td>
                          </tr>
                          <tr>
                            <th>X</th>
                            <td class="c_h"><span>西藏</span><span>香港</span><span>新疆</span></td>
                          </tr>
                          <tr>
                            <th>Y</th>
                            <td class="c_h"><span>云南</span></td>
                          </tr>
                          <tr>
                            <th>Z</th>
                            <td class="c_h"><span>浙江</span></td>
                          </tr>
                        </table>
                    </div>
                </div>
            </span>
        </span>
            <!--End 所在收货地区 End-->
            <span class="fr">
        	<span class="fl">你好，{{$data.user.username ?  $data.user.username : '请登录'}}&nbsp;<a v-if="!$data.user.username" href="Login.html">登录</a>&nbsp;&nbsp;<a v-if="$data.user.username" href="javascript:void(0)" @click="logout()">注销</a>&nbsp;&nbsp; <a href="Regist.html" style="color:#ff4e00;">免费注册</a>&nbsp;|&nbsp;<a
                    href="#">我的订单</a>&nbsp;|</span>
        	<span class="ss">
            	<div class="ss_list">
                	<a href="#">收藏夹</a>
                    <div class="ss_list_bg">
                    	<div class="s_city_t"></div>
                        <div class="ss_list_c">
                        	<ul>
                            	<li><a href="#">我的收藏夹</a></li>
                                <li><a href="#">我的收藏夹</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="ss_list">
                	<a href="#">客户服务</a>
                    <div class="ss_list_bg">
                    	<div class="s_city_t"></div>
                        <div class="ss_list_c">
                        	<ul>
                            	<li><a href="#">客户服务</a></li>
                                <li><a href="#">客户服务</a></li>
                                <li><a href="#">客户服务</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="ss_list">
                	<a href="#">网站导航</a>
                    <div class="ss_list_bg">
                    	<div class="s_city_t"></div>
                        <div class="ss_list_c">
                        	<ul>
                            	<li><a href="#">网站导航</a></li>
                                <li><a href="#">网站导航</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </span>
            <span class="fl">|&nbsp;关注我们：</span>
            <span class="s_sh"><a href="#" class="sh1">新浪</a><a href="#" class="sh2">微信</a></span>
            <span class="fr">|&nbsp;<a href="#">手机版&nbsp;<img src="images/s_tel.png" align="absmiddle" /></a></span>
        </span>
        </div>
    </div>
    <div class="m_top_bg">
        <div class="top">
            <div class="m_logo"><a href="Index.html"><img src="images/logo1.png" /></a></div>

            <div class="i_car">
                <div class="car_t">购物车 [ <span>{{productLength}}</span> ]</div>
                <div class="car_bg">
                    <!--Begin 购物车未登录 Begin-->
                    <ul v-if="$data.user.username" class="cars">
                        <li v-for="(item, index) in products" :key="index" >
                            <div class="img"><a href="#"><img height="58" :src="'http://localhost:8080/getImage?filePath=' + item.filePath" width="58"/></a></div>
                            <div class="name"><a href="#">{{item.name}}</a></div>
                            <div class="price"><font color="#ff4e00">￥{{item.price}}</font> X{{item.count}}</div>
                        </li>
                        <div class="price_sum">共计&nbsp; <font color="#ff4e00">￥</font><span>{{totalPrice}}</span></div>
                        <div class="price_a"><a href="#">去购物车结算</a></div>
                    </ul>
                    <div v-else class="un_login">
                        还未登录！<a href="Login.html" style="color:#ff4e00;">马上登录</a> 查看购物车！

                    </div>

                    <!--End 购物车已登录 End-->
                </div>
            </div>
        </div>
    </div>
    <!--End Header End-->
    <div class="i_bg bg_color">
        <!--Begin 用户中心 Begin -->
        <div class="m_content">
            <div class="m_left">
                <div class="left_n">管理中心</div>
                <div class="left_m">
                    <div class="left_m_t t_bg1">订单中心</div>

                    <ul>
                        <li><a href="Member_Product.html" class="now">我的订单</a></li>
                        <li><a href="Member_Address.html">收货地址</a></li>
                        <li><a href="#">缺货登记</a></li>
                        <li><a href="#">跟踪订单</a></li>
                    </ul>
                </div>
                <div class="left_m">
                    <div class="left_m_t t_bg2">会员中心</div>
                    <ul>
                        <li><a href="Member_User.html">用户信息</a></li>
                        <li><a href="Member_Collect.html">我的收藏</a></li>
                        <li><a href="Member_Msg.html">我的留言</a></li>
                        <li><a href="Member_Links.html">推广链接</a></li>
                        <li><a href="#">我的评论</a></li>
                    </ul>
                </div>
                <div class="left_m">
                    <div class="left_m_t t_bg3">账户中心</div>
                    <ul>
                        <li><a href="Member_Safe.html">账户安全</a></li>
                        <li><a href="Member_Packet.html">我的红包</a></li>
                        <li><a href="Member_Money.html">资金管理</a></li>
                    </ul>
                </div>
                <div class="left_m">
                    <div class="left_m_t t_bg4">分销中心</div>
                    <ul>
                        <li><a href="Member_Member.html">我的会员</a></li>
                        <li><a href="Member_Results.html">我的业绩</a></li>
                        <li><a href="Member_Commission.html">我的佣金</a></li>
                        <li><a href="Member_Cash.html">申请提现</a></li>
                    </ul>
                </div>
            </div>
            <div class="m_right">
                <p></p>
                <div class="mem_tit">商品管理</div>
                <a-row type="flex" justify="center">
                    <a-col :span="12">
                        <a-form-model
                                ref="productsForm"
                                :model="productsOptions"
                                :rules="rules"
                                :label-col="labelCol"
                                :wrapper-col="wrapperCol"
                        >
                            <a-form-model-item has-feedback prop="name" label="产品名字:">
                                 <a-input v-model="productsOptions.name" @blur="onFieldBlur('name')"></a-input>
                            </a-form-model-item>
                            <a-form-model-item label="商品描述" prop="description" >
                                <a-input v-model="productsOptions.description" @blur="onFieldBlur('description')"></a-input>
                            </a-form-model-item>

                            <a-form-model-item prop="stock" label="库存:">
                                 <a-input v-model="productsOptions.stock" ></a-input>
                            </a-form-model-item>
                            <a-form-model-item prop="price" label="价格:">
                                 <a-input v-model="productsOptions.price" ></a-input>
                            </a-form-model-item>
                            <a-form-model-item label="品牌" prop="brandId">
                                <el-select v-model.number="productsOptions.brandId" placeholder="请选择">
                                    <el-option v-for="brand in brandOptions" :key="brand.id" :value="brand.id" :label="brand.name">{{ brand.name }}</el-option>
                                </el-select>
                            </a-form-model-item>


                            <a-form-model-item prop="categoryLevelId" label="具体类别" v-model="productsOptions.categoryLevelId">
                                    <el-cascader :options="theFirst" placeholder="Please select" @change="onChange($event)" ></el-cascader>
                            </a-form-model-item>
                            <a-form-model-item prop="filePaths" label="图片上传">
                                <el-upload
                                        action="/upload"
                                        name="filePath"
                                        :before-upload="beforeUpload"
                                        :on-success="onUploadSuccess"
                                        :on-remove="onRemoveFile"
                                        :limit="1"
                                        :on-exceed="handleExceed"
                                >
                                    <el-button size="small" type="primary">点击上传</el-button>
                                    <div slot="tip" class="el-upload__tip">只能上传jpg/png文件，且不超过2mb</div>
                                </el-upload>
                            </a-form-model-item>




                            <a-form-model-item >
                                <a-button type="primary" @click="onSubmit('productsForm')">添加</a-button>
                                <a-button style="margin-left: 10px" @click="resetForm('productsForm')">重置</a-button>
                            </a-form-model-item>
                        </a-form-model>
                    </a-col>
                </a-row>


            </div>
        </div>
        <!--End 用户中心 End-->
        <!--Begin Footer Begin -->
        <div class="b_btm_bg b_btm_c">
            <div class="b_btm">
                <table border="0" style="width:210px; height:62px; float:left; margin-left:75px; margin-top:30px;" cellspacing="0" cellpadding="0">
                    <tr>
                        <td width="72"><img src="images/b1.png" width="62" height="62" /></td>
                        <td><h2>正品保障</h2>正品行货  放心购买</td>
                    </tr>
                </table>
                <table border="0" style="width:210px; height:62px; float:left; margin-left:75px; margin-top:30px;" cellspacing="0" cellpadding="0">
                    <tr>
                        <td width="72"><img src="images/b2.png" width="62" height="62" /></td>
                        <td><h2>满38包邮</h2>满38包邮 免运费</td>
                    </tr>
                </table>
                <table border="0" style="width:210px; height:62px; float:left; margin-left:75px; margin-top:30px;" cellspacing="0" cellpadding="0">
                    <tr>
                        <td width="72"><img src="images/b3.png" width="62" height="62" /></td>
                        <td><h2>天天低价</h2>天天低价 畅选无忧</td>
                    </tr>
                </table>
                <table border="0" style="width:210px; height:62px; float:left; margin-left:75px; margin-top:30px;" cellspacing="0" cellpadding="0">
                    <tr>
                        <td width="72"><img src="images/b4.png" width="62" height="62" /></td>
                        <td><h2>准时送达</h2>收货时间由你做主</td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="b_nav">
            <dl>
                <dt><a href="#">新手上路</a></dt>
                <dd><a href="#">售后流程</a></dd>
                <dd><a href="#">购物流程</a></dd>
                <dd><a href="#">订购方式</a></dd>
                <dd><a href="#">隐私声明</a></dd>
                <dd><a href="#">推荐分享说明</a></dd>
            </dl>
            <dl>
                <dt><a href="#">配送与支付</a></dt>
                <dd><a href="#">货到付款区域</a></dd>
                <dd><a href="#">配送支付查询</a></dd>
                <dd><a href="#">支付方式说明</a></dd>
            </dl>
            <dl>
                <dt><a href="#">会员中心</a></dt>
                <dd><a href="#">资金管理</a></dd>
                <dd><a href="#">我的收藏</a></dd>
                <dd><a href="#">我的订单</a></dd>
            </dl>
            <dl>
                <dt><a href="#">服务保证</a></dt>
                <dd><a href="#">退换货原则</a></dd>
                <dd><a href="#">售后服务保证</a></dd>
                <dd><a href="#">产品质量保证</a></dd>
            </dl>
            <dl>
                <dt><a href="#">联系我们</a></dt>
                <dd><a href="#">网站故障报告</a></dd>
                <dd><a href="#">购物咨询</a></dd>
                <dd><a href="#">投诉与建议</a></dd>
            </dl>
            <div class="b_tel_bg">
                <a href="#" class="b_sh1">新浪微博</a>
                <a href="#" class="b_sh2">腾讯微博</a>
                <p>
                    服务热线：<br />
                    <span>400-123-4567</span>
                </p>
            </div>
            <div class="b_er">
                <div class="b_er_c"><img src="images/er.gif" width="118" height="118" /></div>
                <img src="images/ss.png" />
            </div>
        </div>
        <div class="btmbg">
            <div class="btm">
                备案/许可证编号：蜀ICP备12009302号-1-www.dingguagua.com   Copyright © 2015-2018 尤洪商城网 All Rights Reserved. 复制必究 , Technical Support: Dgg Group <br />
                <img src="images/b_1.gif" width="98" height="33" /><img src="images/b_2.gif" width="98" height="33" /><img src="images/b_3.gif" width="98" height="33" /><img src="images/b_4.gif" width="98" height="33" /><img src="images/b_5.gif" width="98" height="33" /><img src="images/b_6.gif" width="98" height="33" />
            </div>
        </div>
    </div>
</div>
</body>
<script type="text/javascript" src="js/request.js"></script>
<script type="text/javascript">
    new Vue({
        el: '#app15',

        data() {
            let checkProductName=(rule, value, callback) =>{
                axios
                    .get("/getProductByLogin",{params:{name:value}})
                    .then((resp) => {
                        if (!value) {
                            callback(new Error("请输入名字"));
                        }else if (resp.code !== 200) {
                            callback(new Error("名字已经存在"));
                        }else {
                            callback()
                        }
                    })
                    .catch((error) => {
                        console.error("添加失败", error);
                    });
            }
            return{
                products:[],
                brandOptions:[],
                productLength:"",
                totalPrice:"",
                user:{
                    username:"",
                    id:null,
                },
                productsOptions: {
                    name: "",
                    description: "",
                    stock: null,
                    price: null,
                    brandId: null,
                    filePath: "",
                    userId: null,
                    categoryLevelId:null,
                },

                labelCol: { span: 4 },
                wrapperCol: { span: 14 },

                theFirst:[],
                rules: {
                    name: [
                        { required: true, message: '请输入产品名称', trigger: 'blur' },
                        { validator: checkProductName, trigger: 'blur' }
                    ],
                    description: [
                        { required: true, message: '请输入商品描述', trigger: 'blur' },
                        { min: 1, max: 100, message: '商品描述长度在1到100之间', trigger: 'blur' }
                    ],
                    stock: [
                        { required: true, message: '请输入库存数量', trigger: 'blur' },
                        { pattern: /^\d+$/, message: '库存数量必须为正整数', trigger: 'blur' }
                    ],
                    price: [
                        { required: true, message: '请输入价格', trigger: 'blur' },
                        { pattern: /^\d+(\.\d+)?$/, message: '价格必须为正数', trigger: 'blur' }
                    ]
                }
            }


        },
        methods: {
            checkRoled() {
                let token=localStorage.getItem("token");
                axios.get('http://localhost:8080/checkRoled', {params: {token: token}})
                    .then((resp) => {

                    });
            },
            initLogin() {
                let token=localStorage.getItem("token");
                axios.get('http://localhost:8080/getUser', {params: {token: token}})
                    .then((resp) => {
                        console.log(resp.data);
                        this.user.username=resp.data.userName
                        this.user.id=resp.data.id
                        this.productsOptions.userId=resp.data.id
                    });
            },
            initCat() {
                let token=localStorage.getItem("token");
                axios.get('http://localhost:8080/getAllCats', {params: {token: token}})
                    .then((resp) => {
                        console.log(resp.data);
                        this.products=resp.data
                        let sum = 0;
                        this.productLength=this.products.length
                        for (let i = 0; i < this.products.length; i++) {
                            sum += this.products[i].price*this.products[i].count;
                            this.totalPrice=sum;
                        }

                    });
            },
            initBrand() {
                axios.get('http://localhost:8080/getBrand')
                    .then((resp) => {
                        console.log(resp.data);
                       this.brandOptions=resp.data

                    });
            },

            onChange(value) {
                console.log(value[0]);
                this.categoryLevelId=value[0];
            },
            getAllCategory() {
                axios.get('http://localhost:8080/getAllCategory')
                    .then((resp) => {
                        console.log(resp.data);
                        this.theFirst = resp.data.map(item => ({
                            value: item.id,
                            label: item.name,
                            children:item.childCategory?item.childCategory.map(child=>({
                                value: child.id,
                                label: child.name,
                                children:child.childCategory?child.childCategory.map(grandchild=>({
                                    value: grandchild.id,
                                    label: grandchild.name,
                                })):[]
                            })):[]
                        }));
                    });
            },
            beforeUpload(file) {
                const isJPG = file.type === 'image/jpeg' || file.type === 'image/png';
                const isLt2M = file.size / 1024 / 1024 < 2;

                if (!isJPG) {
                    this.$message.error('上传图片只能是 JPG/PNG 格式!');
                    return
                }
                if (!isLt2M) {
                    this.$message.error('上传图片大小不能超过 2MB!');
                    return
                }
                return isJPG && isLt2M;
            },
            onRemoveFile(file, fileList) {
                this.productsOptions.filePath = ""
            },
            handleExceed(files, fileList) {
                this.$message.warning(`当前限制选择 1个文件`);
            },
            onUploadSuccess(response) {
                console.log(response)

                if (response.code === 200) {
                    this.$message.success('文件上传成功');
                    console.log(response)
                    this.productsOptions.filePath=response.data
                } else {
                    this.$message.error('文件上传失败');
                }
            },
            onSubmit(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        axios
                            .post("/addProduct", this.productsOptions)
                            .then((resp) => {
                                if (resp.code=== 200) {
                                    window.location.href="Member_Product.html"
                                }
                            })
                            .catch((error) => {
                                console.error("添加失败", error);
                            });
                    } else {
                        console.log("表单验证失败");
                    }
                });
            },
            onFieldBlur(field) {
                this.$refs.productsForm.validateField(field);
            },

        },
        mounted() {
            this.checkRoled()
            this.initLogin()
            this.initCat()
            this.getAllCategory()
            this.initBrand()
        }
    })
</script>

</html>
